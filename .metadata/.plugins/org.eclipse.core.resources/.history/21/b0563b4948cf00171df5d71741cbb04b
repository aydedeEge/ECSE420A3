package ca.mcgill.ecse420.a3;

public class FineGrainTesting {
	
	public static void main(String[] args){
		
		//These are in order of increasing key values
		QNode strawberry = new QNode.QNodeBuilder("strawberry").build();
		QNode apple = new QNode.QNodeBuilder("apple").setNext(strawberry).build();
		QNode kiwi = new QNode.QNodeBuilder("kiwi").setNext(apple).build();
		QNode banana = new QNode.QNodeBuilder("banana").setNext(kiwi).build();
		
//		QNode head = banana;
//		while(head!=null){
//			System.out.println("Fruit: " + head.fruit + ", Hashcode: " + head.key);
//			head = head.next;
//		}
		
		System.out.println(contains(banana, "kiwi"));
	}
	
	public static boolean contains(QNode head, String fruit){
		QNode curr = head, nextNode = head;
		int key = fruit.hashCode();
		
		if(head==null){
			return false;
		}else{
			curr.nodeLock.lock();
		}
		
		try{
			while(curr.key<=key){
				if(fruit==curr.fruit){
					return true;
				}
				System.out.println(curr.nodeLock.isHeldByCurrentThread());
				curr.nodeLock.unlock();
				curr = nextNode;
				System.out.println(curr.nodeLock.isHeldByCurrentThread());
				nextNode = nextNode.next;
				nextNode.nodeLock.lock();
			}
			return false;
		}finally{	
			pred.nodeLock.unlock();
			curr.nodeLock.unlock();
		}
	}
}
